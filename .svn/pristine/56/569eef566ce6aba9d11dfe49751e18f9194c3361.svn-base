

var p_customer_id="";
var p_month="";
var p_year="";
var p_area_id="";
var p_customer_category="";
var bindutest="";

$("#bill_delete_grid").jqGrid($.extend(true, {}, scrollPagerGridOptions, {
	//url: jsEnum.GRID_RECORED_FETCHER+'?service=org.jgtdsl.models.BillingService&method=getMeteredBilledCustomerList'+'&extraFilter=area',
	url: jsEnum.GRID_RECORED_FETCHER+'?service=org.jgtdsl.models.BillingService&method=searchIndividualBill'+'&extraFilter=area'+'&toMonthYear='+toMonthYear+"&fromMonthYear="+fromMonthYear,
	jsonReader: {
            repeatitems: false,
            id: "bill_id"
	},
	colNames: [ 'Bill ID','Is metered','Month Year','Payable Amount','Status','Creation Date','Delete'],
	   colModel: [
	            	{
		                name: 'bill_id',
		                index: 'bill_id',
		                width:50,
		                sorttype: "string",
		                search: true,
	            	},
	            	{
		                name: 'is_metered',
		                index: 'is_metered',
		                width:80,
		                sorttype: "string",
		                hidden: true,
		                align:'left',
		                search: true,
	            	},
	            	{
		                name: 'month_year',
		                index: 'month_year',
		                width:80,
		                sorttype: "string",
		                align:'left',
		                search: true,
	            	},
	            	
	            	{
		                name: 'total_bill_amount',
		                index: 'total_bill_amount',
		                sorttype: "string",
		                align:'right',
		                width:80,
		                search: true,
	            	},
	            	
	            	{
		                name: 'status',
		                index: 'status',
		                sorttype: "string",
		                align:'center',
		                width:80,
		                search: true,
	            	},
	            	
	            	{
		                name: 'prepeared_date',
		                index: 'prepeared_date',
		                sorttype: "string",
		                align:'center',
		                width:80,
		                search: true,
	            	},
	            	            	
	            	{ 
	            		name: 'Delete', 
	            		width: 17,
	            		cursor: 'pointer',
	            		align:'center',
	            		formatter: function(cellvalue, options, rowObject){
	            			
	                          return "<button class='btn btn-danger' ><span class='ui-icon 	ui-icon-closethick' style='align:center;   '>Delete</span></button>";
	          
	                    },
	                    cellattr: function (rowId, tv, rowObject, cm, rdata) {                 	
	                    	
	                    	return ' onClick="approveBillByBillId('+rowObject.bill_id+')"';
	                    },
	                    
	                }
	        ],
	datatype: 'local',
	height: $("#bill_grid_div").height()-80,
	width: $("#bill_grid_div").width()-2,
   	pager: '#bill_grid_pager',
   	sortname: 'bill_id',
    sortorder: "desc",
	caption: "Metered Customers List(Billed)"
}));

jQuery("#bill_delete_grid").jqGrid('navGrid','#bill_grid_pager',$.extend({},footerButton,{search:true,refresh:true,beforeRefresh: function () {reloadBillGrid();}}),{},{},{},{multipleSearch:true});

function reloadBillGrid(){	
	
	var from_month=$("#billing_month1").val();
	var to_month= $("#billing_month2").val();
	
	if(from_month.length==1){
		from_month="0"+from_month;
	}
	
	if(to_month.length==1){
		to_month="0"+to_month;
	}
	
	 fromMonthYear= $("#billing_year1").val()+from_month;
	 toMonthYear= $("#billing_year2").val()+to_month;	
	
    var ruleArray=[["customer_id","fromMonthYear","toMonthYear",],["eq","eq","eq"],[$("#customer_id").val(),fromMonthYear,toMonthYear]];
    var $grid = $('#bill_delete_grid');
    
    //var ruleArray=[[$("#billing_year1").val()+$("#billing_month1").val(),$("#billing_year2").val()+$("#billing_month2").val()]];
    
    var caption_extra="";
    
	
	p_month=$("#billing_month").val();
	p_year=$("#billing_year").val();
	
	var postdata=getPostFilter("bill_delete_grid",ruleArray);
   	$("#bill_delete_grid").jqGrid('setGridParam',{search: true,postData: postdata,page:1,datatype:'json'});    		
	reloadGrid("bill_delete_grid");
	
	$grid.jqGrid('setCaption', ' Bills of || '+$("#customer_id").val()+' ||'+$("#billing_month option:selected").text()+', '+$("#billing_year").val()+caption_extra);
}



Calendar.setup({
        inputField : "issue_date",
        trigger    : "issue_date",
		eventName : "focus",
        onSelect   : function() { this.hide();},
        showTime   : 12,
        dateFormat : "%d-%m-%Y",
		showTime : true
});
     

function approveBillByBillId(bill_id)
{
	alert(bill_id);
	/*
	$("#bill_id").hide();
 	$.ajax({
	  type: 'POST',
	  url: 'approveBillByBillId.action?isMetered=1',
	  data: {bill_id:bill_id},
	  success:function(data)
	  {	    
		alert(data.message);
        reloadBillGrid();
        $("#bill_id").show();
		//refreshTable1();
	  },
	  error:function (xhr, ajaxOptions, thrownError) {
	      alert(xhr.status);
	      alert(thrownError);
	      $("#bill_id").show();
      }
	});*/
	
}



$("#billing_month").val(getCurrentMonth());
$("#billing_year").val(getCurrentYear());
//$("#issue_date").val(getCurrentDate());
reloadBillGrid();



